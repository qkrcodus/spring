#### 웹 어플리케이션에서 싱글톤이 사용되는 이유

- 여러 고객이 동시에 요청을 보내고 여러 요청을 보내기에 객체가 계속 생성 된다.
#### AppConfig
![](https://i.imgur.com/uEICwTb.png)

클라이언트가 memberService를 요청하면 new MemberServiceImpl 로 객체를 생성하고 이를 반환한다

#### jvm 메모리에 무수히 많은 객체가 생성되고 있다.
![](https://i.imgur.com/YBaMm9a.png)

[ 싱글톤 패턴 ]
메모리 낭비를 해결할 수 있는 좋은 방안은 객체를 1개만 생성하고, 생성된 객체를 공유하면 된다. 

---
### 싱글톤 패턴

[ 리마인드 ]
- static 문법
객체가 아닌 클래스에 소속된다. 모든 객체가 이를 공유한다.

![](https://i.imgur.com/ThSRElT.png)

객체를 생성하기 전에 class 로딩시 자기 자신을 static 영역에서 class 레벨로 1개만 올려둔다. 

![](https://i.imgur.com/sKLq3M6.png)

생성자를 private 으로 막아뒀기에 외부에서 new 키워드로 생성자를 호출하여 새로운 SingletonService를 호출하는 것을 막는다.

#### singletonTest
![](https://i.imgur.com/fX1o4jP.png)

참조값이 같다

[ 스프링 컨테이너는 객체를 기본적으로 싱글톤으로 만들어주며 생길 수 있는 모든 문제들을 해결해준다. ]

---
### 스프링 컨테이너

- 알아서 싱글톤으로 관리한다
- 빈을 등록한 뒤 이를 공유한다
- 싱글톤 패턴의 단점을 모두 해결하며 객체를 하나만 생성한다

#### singletonTest
![](https://i.imgur.com/WY0nsr4.png)

스프링 컨테이너 덕에 고객 요청이 올 때마다 객체를 생성하는게 아니라, 이미 만들어진 객체를 공유해서 사용한다. [ 컨테이너 사용 이유 ]

참고로, 고객 요청따라 객체를 생성하게도 할 수 있다.

---
### 싱글톤 방식의 주의점 [ 아주 중요하다]

- 싱글톤은 무상태로 설계해야한다
- 가급적 읽기만 값을 수정 x
- 필드 대신 공유되지 않는, 지역변수 , 파라미터, threadlocal을 사용해야한다

#### StatefulService
![](https://i.imgur.com/Qze2W3o.png)

#### StatefulServiceTest
![](https://i.imgur.com/TGXYi4d.png)

같은 객체의 price 필드를 수정하며 상태를 갖고 있기에 출력해보면 10000 이 덮어쓰여져서 20000으로 출력된다.

---
### Configuration 과 싱글톤

![](https://i.imgur.com/80fajI8.png)

( 주석 참고 )
싱글톤인데 객체가 두 번 만들어지는 것인가? 아니다

#### ConfigurationSingletonTest
![](https://i.imgur.com/jPi4lBB.png)
테스트 코드를 적어서 이를 확인 할 수 있다. 모두 다 같은 객체다

---


