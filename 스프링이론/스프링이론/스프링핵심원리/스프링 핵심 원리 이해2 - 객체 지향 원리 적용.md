기존의 할인 정책은 vip 면 1000원 할인
근데
10% 할인 되게 할인 정책을 바꾸고 싶다

![](https://i.imgur.com/0Si2hiF.png)

### RateDiscountPolicy 구현체와 테스트를 추가하자

[ 단축키 ]
- 테스트 작성 command shift t
- assertions static import  option enter
  
- RateDiscountPolicy 
![](https://i.imgur.com/AoW5CRO.png)

- RateDiscountPolicyTest
![](https://i.imgur.com/6Jguz0v.png)

---
### OrderServiceImpl 을 수정하여 RateDiscountPolicy를 적용해보자

![](https://i.imgur.com/esI7Arj.png)

하지만, 이는 DIP( OrderServiceImpl이 추상화 - 인터페이스 에도 의존하고, 구체화 - 구현체 (FixDiscountPolicy,RateDiscountPolicy)에도 의존하므로) 원칙을 위반하고

OCP ( 변경엔 열려있지만 수정엔 닫혀 있지 않으므로 ) 원칙도 위반한다

![](https://i.imgur.com/kzINPn7.png)

### 변경해보자

![](https://i.imgur.com/mLRi1iW.png)

인터페이스에만 의존하게 수정하면 createOrder 메소드에서 빈 객체에 . 으로 접근하니 NPE 발생

---
### 수정해보자 - 관심사의 분리 ( 생성자 주입 )

OrderServiceImpl 이 구현체를 지정하는 역할까지 맡고 있기에 문제가 되는거다
( 연극에서 로미오 역할을 맡은 레오나르도 디카프리오가 줄리엣 역할로 누가 될지 저정해주는 책임을 갖는거랑 비슷한 느낌 )

- AppConfig 를 생성하여 관심사를 분리하여 OrderServiceImpl 과 MemberServiceImpl 가 오직 추상화 ( 인터페이스 )에만 의존하게 수정하자

- AppConfig 는 생성자를 통해 구현체를 주입한다
#### AppConfig
![](https://i.imgur.com/nKqMiIY.png)
#### MemberServiceImpl
![](https://i.imgur.com/SwPKh8x.png)
#### OrderServiceImpl
![](https://i.imgur.com/vadt17w.png)

[ 단축키 ]
생성자 단축키 cmd n


![](https://i.imgur.com/CRxOECT.png)

**public MemberService memberService(){
        return new MemberServiceImpl(new MemoryMemberRepository());
    };**

appConfig 객체는 memoryMemberRepository 객체를 생성하고 그 참조값을 memberServiceImpl 을 생성하면서 생성자로 전달한다.

---
#### MemberApp
![](https://i.imgur.com/AVD1cNH.png)
#### OrderApp
![](https://i.imgur.com/VTMTNxM.png)

AppConfig 에 의존하도록 두 파일을 변경하고, 의존 관계를 appconfig 에서 생성자로 주입받도록 한다

#### MemberServiceTest
![](https://i.imgur.com/DbTy4ef.png)
#### OrderServiceTest
![](https://i.imgur.com/P0WF02o.png)

테스트 코드도 appConfig 에 의존하게 수정했다

AppConfig는 공연 기획자고 배역에 맞는 담당 배우를 선택한다. 즉, 구체 클래스를 선택한다. 

---
### AppConfig 리팩토링

appConfig 만 보고도 이 어플리케이션의 역할과 구현이 뚜렷하게 잘 드러나도록 수정해보자
[ 후 ]
![](https://i.imgur.com/Cu7C0qY.png)

- 리턴 타입을 보고 역할
- 반환하는 객체를 보고 구현이 한눈에 들어온다.

[ 전 ]
![](https://i.imgur.com/84UPxZY.png)

new MemoryMemberRepository() 이 부분이 중복되어 예를 들어 jdbcmemorymemberrepository 로 수정하고 싶으면 코드를 두 번이나 수정해야 한다. 
